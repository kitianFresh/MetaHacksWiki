<!DOCTYPE HTML>
<html>
    <head>
        <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
        <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
        <link rel="Stylesheet" type="text/css" href="/static/plugin/tipuesearch/css/tipuesearch.css">
        <link rel="stylesheet" href="/static/plugin/tipuesearch/css/normalize.css">
        <link rel="stylesheet" href="/static/plugin/tipuesearch/css/tipuesearch.css">
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/favicon.ico" type="image/x-icon">
        <title>rnn-basics - MetaHacks Wiki</title>
        <meta name="keywords" content="wiki, simiki, computer, cognitive,"/>
        <meta name="description" content="my personal wiki"/>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="viewport" content="width=device-width" />

        <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [ ['$','$'], ['\\(','\\)'] ]
            }
        });
        </script>
        <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML'></script>
        <!--script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script!-->
        <script src="https://code.jquery.com/jquery-2.2.4.min.js"
            integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
            crossorigin="anonymous"></script>

        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-114706319-1"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'UA-114706319-1');
        </script>
        
        <!-- Baidu Analytics -->
        <script>
            var _hmt = _hmt || [];
            (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?6e445c332d0cb95f356894a8d3b9f545";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
            })();
        </script>


    </head>

    <body>
        <div id="container">
            
<div id="header">
  <div id="post-nav"><a href="/">Home</a>&nbsp;»&nbsp;<a href="/#machinelearning">machinelearning</a>&nbsp;»&nbsp;<a href="/#-deeplearning">deeplearning</a>&nbsp;»&nbsp;rnn-basics</div>
</div>
<div class="clearfix"></div>
<div id="title">rnn-basics</div>
<div id="content">
  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#building-your-recurrent-neural-network-step-by-step">Building your Recurrent Neural Network - Step by Step</a><ul>
<li><a href="#1-forward-propagation-for-the-basic-recurrent-neural-network">1 - Forward propagation for the basic Recurrent Neural Network</a></li>
<li><a href="#11-rnn-cell">1.1 - RNN cell</a></li>
<li><a href="#12-rnn-forward-pass">1.2 - RNN forward pass</a></li>
<li><a href="#2-long-short-term-memory-lstm-network">2 - Long Short-Term Memory (LSTM) network</a><ul>
<li><a href="#about-the-gates">About the gates</a><ul>
<li><a href="#-forget-gate">- Forget gate</a></li>
<li><a href="#-update-gate">- Update gate</a></li>
<li><a href="#-updating-the-cell">- Updating the cell</a></li>
<li><a href="#-output-gate">- Output gate</a></li>
</ul>
</li>
<li><a href="#21-lstm-cell">2.1 - LSTM cell</a></li>
<li><a href="#22-forward-pass-for-lstm">2.2 - Forward pass for LSTM</a></li>
</ul>
</li>
<li><a href="#3-backpropagation-in-recurrent-neural-networks-optional-ungraded">3 - Backpropagation in recurrent neural networks (OPTIONAL / UNGRADED)</a><ul>
<li><a href="#31-basic-rnn-backward-pass">3.1 - Basic RNN  backward pass</a><ul>
<li><a href="#deriving-the-one-step-backward-functions">Deriving the one step backward functions:</a></li>
<li><a href="#backward-pass-through-the-rnn">Backward pass through the RNN</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#32-lstm-backward-pass">3.2 - LSTM backward pass</a><ul>
<li><a href="#321-one-step-backward">3.2.1 One Step backward</a></li>
<li><a href="#322-gate-derivatives">3.2.2 gate derivatives</a></li>
<li><a href="#323-parameter-derivatives">3.2.3 parameter derivatives</a></li>
<li><a href="#33-backward-pass-through-the-lstm-rnn">3.3 Backward pass through the LSTM RNN</a></li>
<li><a href="#congratulations">Congratulations !</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<h1 id="building-your-recurrent-neural-network-step-by-step">Building your Recurrent Neural Network - Step by Step</h1>
<p>Welcome to Course 5's first assignment! In this assignment, you will implement your first Recurrent Neural Network in numpy.</p>
<p>Recurrent Neural Networks (RNN) are very effective for Natural Language Processing and other sequence tasks because they have "memory". They can read inputs $x^{\langle t \rangle}$ (such as words) one at a time, and remember some information/context through the hidden layer activations that get passed from one time-step to the next. This allows a uni-directional RNN to take information from the past to process later inputs. A bidirection RNN can take context from both the past and the future. </p>
<p><strong>Notation</strong>:<br />
- Superscript $[l]$ denotes an object associated with the $l^{th}$ layer. <br />
    - Example: $a^{[4]}$ is the $4^{th}$ layer activation. $W^{[5]}$ and $b^{[5]}$ are the $5^{th}$ layer parameters.</p>
<ul>
<li>
<p>Superscript $(i)$ denotes an object associated with the $i^{th}$ example. </p>
<ul>
<li>Example: $x^{(i)}$ is the $i^{th}$ training example input.</li>
</ul>
</li>
<li>
<p>Superscript $\langle t \rangle$ denotes an object at the $t^{th}$ time-step. </p>
<ul>
<li>Example: $x^{\langle t \rangle}$ is the input x at the $t^{th}$ time-step. $x^{(i)\langle t \rangle}$ is the input at the $t^{th}$ timestep of example $i$.</li>
</ul>
</li>
<li>
<p>Lowerscript $i$ denotes the $i^{th}$ entry of a vector.</p>
<ul>
<li>Example: $a^{[l]}_i$ denotes the $i^{th}$ entry of the activations in layer $l$.</li>
</ul>
</li>
</ul>
<p>We assume that you are already familiar with <code>numpy</code> and/or have completed the previous courses of the specialization. Let's get started!</p>
<p>Let's first import all the packages that you will need during this assignment.</p>
<div class="hlcode"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">rnn_utils</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>


<h2 id="1-forward-propagation-for-the-basic-recurrent-neural-network">1 - Forward propagation for the basic Recurrent Neural Network</h2>
<p>Later this week, you will generate music using an RNN. The basic RNN that you will implement has the structure below. In this example, $T_x = T_y$. </p>
<p><img src="/static/images/ML/DL/rnn/RNN.png" style="width:500;height:300px;"><br />
<caption><center> <strong>Figure 1</strong>: Basic RNN model </center></caption></p>
<p>Here's how you can implement an RNN: </p>
<p><strong>Steps</strong>:<br />
1. Implement the calculations needed for one time-step of the RNN.<br />
2. Implement a loop over $T_x$ time-steps in order to process all the inputs, one at a time. </p>
<p>Let's go!</p>
<h2 id="11-rnn-cell">1.1 - RNN cell</h2>
<p>A Recurrent neural network can be seen as the repetition of a single cell. You are first going to implement the computations for a single time-step. The following figure describes the operations for a single time-step of an RNN cell. </p>
<p><img src="/static/images/ML/DL/rnn/rnn_step_forward.png" style="width:700px;height:300px;"><br />
<caption><center> <strong>Figure 2</strong>: Basic RNN cell. Takes as input $x^{\langle t \rangle}$ (current input) and $a^{\langle t - 1\rangle}$ (previous hidden state containing information from the past), and outputs $a^{\langle t \rangle}$ which is given to the next RNN cell and also used to predict $y^{\langle t \rangle}$ </center></caption></p>
<p><strong>Exercise</strong>: Implement the RNN-cell described in Figure (2).</p>
<p><strong>Instructions</strong>:<br />
1. Compute the hidden state with tanh activation: $a^{\langle t \rangle} = \tanh(W_{aa} a^{\langle t-1 \rangle} + W_{ax} x^{\langle t \rangle} + b_a)$.<br />
2. Using your new hidden state $a^{\langle t \rangle}$, compute the prediction $\hat{y}^{\langle t \rangle} = softmax(W_{ya} a^{\langle t \rangle} + b_y)$. We provided you a function: <code>softmax</code>.<br />
3. Store $(a^{\langle t \rangle}, a^{\langle t-1 \rangle}, x^{\langle t \rangle}, parameters)$ in cache<br />
4. Return $a^{\langle t \rangle}$ , $y^{\langle t \rangle}$ and cache</p>
<p>We will vectorize over $m$ examples. Thus, $x^{\langle t \rangle}$ will have dimension $(n_x,m)$, and $a^{\langle t \rangle}$ will have dimension $(n_a,m)$. </p>
<div class="hlcode"><pre><span class="c"># GRADED FUNCTION: rnn_cell_forward</span>


<span class="k">def</span> <span class="nf">tanh</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sigmoid</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">rnn_cell_forward</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">a_prev</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implements a single forward step of the RNN-cell as described in Figure (2)</span>

<span class="sd">    Arguments:</span>
<span class="sd">    xt -- your input data at timestep &quot;t&quot;, numpy array of shape (n_x, m).</span>
<span class="sd">    a_prev -- Hidden state at timestep &quot;t-1&quot;, numpy array of shape (n_a, m)</span>
<span class="sd">    parameters -- python dictionary containing:</span>
<span class="sd">                        Wax -- Weight matrix multiplying the input, numpy array of shape (n_a, n_x)</span>
<span class="sd">                        Waa -- Weight matrix multiplying the hidden state, numpy array of shape (n_a, n_a)</span>
<span class="sd">                        Wya -- Weight matrix relating the hidden-state to the output, numpy array of shape (n_y, n_a)</span>
<span class="sd">                        ba --  Bias, numpy array of shape (n_a, 1)</span>
<span class="sd">                        by -- Bias relating the hidden-state to the output, numpy array of shape (n_y, 1)</span>
<span class="sd">    Returns:</span>
<span class="sd">    a_next -- next hidden state, of shape (n_a, m)</span>
<span class="sd">    yt_pred -- prediction at timestep &quot;t&quot;, numpy array of shape (n_y, m)</span>
<span class="sd">    cache -- tuple of values needed for the backward pass, contains (a_next, a_prev, xt, parameters)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># Retrieve parameters from &quot;parameters&quot;</span>
    <span class="n">Wax</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s">&quot;Wax&quot;</span><span class="p">]</span>
    <span class="n">Waa</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s">&quot;Waa&quot;</span><span class="p">]</span>
    <span class="n">Wya</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s">&quot;Wya&quot;</span><span class="p">]</span>
    <span class="n">ba</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s">&quot;ba&quot;</span><span class="p">]</span>
    <span class="n">by</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s">&quot;by&quot;</span><span class="p">]</span>

    <span class="c">### START CODE HERE ### (≈2 lines)</span>
    <span class="c"># compute next activation state using the formula given above</span>
    <span class="n">a_next</span> <span class="o">=</span> <span class="n">tanh</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Waa</span><span class="p">,</span> <span class="n">a_prev</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Wax</span><span class="p">,</span> <span class="n">xt</span><span class="p">)</span> <span class="o">+</span> <span class="n">ba</span><span class="p">)</span>
    <span class="c"># compute output of the current cell using the formula given above</span>
    <span class="n">yt_pred</span> <span class="o">=</span> <span class="n">softmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Wya</span><span class="p">,</span> <span class="n">a_next</span><span class="p">)</span> <span class="o">+</span> <span class="n">by</span><span class="p">)</span>   
    <span class="c">### END CODE HERE ###</span>

    <span class="c"># store values you need for backward propagation in cache</span>
    <span class="n">cache</span> <span class="o">=</span> <span class="p">(</span><span class="n">a_next</span><span class="p">,</span> <span class="n">a_prev</span><span class="p">,</span> <span class="n">xt</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">a_next</span><span class="p">,</span> <span class="n">yt_pred</span><span class="p">,</span> <span class="n">cache</span>
</pre></div>


<div class="hlcode"><pre><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">xt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">a_prev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">Waa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">Wax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">Wya</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ba</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">by</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Waa&quot;</span><span class="p">:</span> <span class="n">Waa</span><span class="p">,</span> <span class="s">&quot;Wax&quot;</span><span class="p">:</span> <span class="n">Wax</span><span class="p">,</span> <span class="s">&quot;Wya&quot;</span><span class="p">:</span> <span class="n">Wya</span><span class="p">,</span> <span class="s">&quot;ba&quot;</span><span class="p">:</span> <span class="n">ba</span><span class="p">,</span> <span class="s">&quot;by&quot;</span><span class="p">:</span> <span class="n">by</span><span class="p">}</span>

<span class="n">a_next</span><span class="p">,</span> <span class="n">yt_pred</span><span class="p">,</span> <span class="n">cache</span> <span class="o">=</span> <span class="n">rnn_cell_forward</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">a_prev</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;a_next[4] = &quot;</span><span class="p">,</span> <span class="n">a_next</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;a_next.shape = &quot;</span><span class="p">,</span> <span class="n">a_next</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;yt_pred[1] =&quot;</span><span class="p">,</span> <span class="n">yt_pred</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;yt_pred.shape = &quot;</span><span class="p">,</span> <span class="n">yt_pred</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>


<div class="hlcode"><pre><span class="n">a_next</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span> <span class="mf">0.59584544</span>  <span class="mf">0.18141802</span>  <span class="mf">0.61311866</span>  <span class="mf">0.99808218</span>  <span class="mf">0.85016201</span>  <span class="mf">0.99980978</span>
 <span class="o">-</span><span class="mf">0.18887155</span>  <span class="mf">0.99815551</span>  <span class="mf">0.6531151</span>   <span class="mf">0.82872037</span><span class="p">]</span>
<span class="n">a_next</span><span class="p">.</span><span class="n">shape</span> <span class="o">=</span>  <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">yt_pred</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="mf">0.9888161</span>   <span class="mf">0.01682021</span>  <span class="mf">0.21140899</span>  <span class="mf">0.36817467</span>  <span class="mf">0.98988387</span>  <span class="mf">0.88945212</span>
  <span class="mf">0.36920224</span>  <span class="mf">0.9966312</span>   <span class="mf">0.9982559</span>   <span class="mf">0.17746526</span><span class="p">]</span>
<span class="n">yt_pred</span><span class="p">.</span><span class="n">shape</span> <span class="o">=</span>  <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>


<p><strong>Expected Output</strong>: </p>
<table>
    <tr>
        <td>
            **a_next[4]**:
        </td>
        <td>
           [ 0.59584544  0.18141802  0.61311866  0.99808218  0.85016201  0.99980978
 -0.18887155  0.99815551  0.6531151   0.82872037]
        </td>
    </tr>
        <tr>
        <td>
            **a_next.shape**:
        </td>
        <td>
           (5, 10)
        </td>
    </tr>
        <tr>
        <td>
            **yt[1]**:
        </td>
        <td>
           [ 0.9888161   0.01682021  0.21140899  0.36817467  0.98988387  0.88945212
  0.36920224  0.9966312   0.9982559   0.17746526]
        </td>
    </tr>
        <tr>
        <td>
            **yt.shape**:
        </td>
        <td>
           (2, 10)
        </td>
    </tr>

</table>

<h2 id="12-rnn-forward-pass">1.2 - RNN forward pass</h2>
<p>You can see an RNN as the repetition of the cell you've just built. If your input sequence of data is carried over 10 time steps, then you will copy the RNN cell 10 times. Each cell takes as input the hidden state from the previous cell ($a^{\langle t-1 \rangle}$) and the current time-step's input data ($x^{\langle t \rangle}$). It outputs a hidden state ($a^{\langle t \rangle}$) and a prediction ($y^{\langle t \rangle}$) for this time-step.</p>
<p><img src="/static/images/ML/DL/rnn/rnn-1.png" style="width:800px;height:300px;"><br />
<caption><center> <strong>Figure 3</strong>: Basic RNN. The input sequence $x = (x^{\langle 1 \rangle}, x^{\langle 2 \rangle}, ..., x^{\langle T_x \rangle})$  is carried over $T_x$ time steps. The network outputs $y = (y^{\langle 1 \rangle}, y^{\langle 2 \rangle}, ..., y^{\langle T_x \rangle})$. </center></caption></p>
<p><strong>Exercise</strong>: Code the forward propagation of the RNN described in Figure (3).</p>
<p><strong>Instructions</strong>:<br />
1. Create a vector of zeros ($a$) that will store all the hidden states computed by the RNN.<br />
2. Initialize the "next" hidden state as $a_0$ (initial hidden state).<br />
3. Start looping over each time step, your incremental index is $t$ :<br />
    - Update the "next" hidden state and the cache by running <code>rnn_cell_forward</code><br />
    - Store the "next" hidden state in $a$ ($t^{th}$ position) <br />
    - Store the prediction in y<br />
    - Add the cache to the list of caches<br />
4. Return $a$, $y$ and caches</p>
<div class="hlcode"><pre><span class="c"># GRADED FUNCTION: rnn_forward</span>

<span class="k">def</span> <span class="nf">rnn_forward</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implement the forward propagation of the recurrent neural network described in Figure (3).</span>

<span class="sd">    Arguments:</span>
<span class="sd">    x -- Input data for every time-step, of shape (n_x, m, T_x).</span>
<span class="sd">    a0 -- Initial hidden state, of shape (n_a, m)</span>
<span class="sd">    parameters -- python dictionary containing:</span>
<span class="sd">                        Waa -- Weight matrix multiplying the hidden state, numpy array of shape (n_a, n_a)</span>
<span class="sd">                        Wax -- Weight matrix multiplying the input, numpy array of shape (n_a, n_x)</span>
<span class="sd">                        Wya -- Weight matrix relating the hidden-state to the output, numpy array of shape (n_y, n_a)</span>
<span class="sd">                        ba --  Bias numpy array of shape (n_a, 1)</span>
<span class="sd">                        by -- Bias relating the hidden-state to the output, numpy array of shape (n_y, 1)</span>

<span class="sd">    Returns:</span>
<span class="sd">    a -- Hidden states for every time-step, numpy array of shape (n_a, m, T_x)</span>
<span class="sd">    y_pred -- Predictions for every time-step, numpy array of shape (n_y, m, T_x)</span>
<span class="sd">    caches -- tuple of values needed for the backward pass, contains (list of caches, x)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># Initialize &quot;caches&quot; which will contain the list of all caches</span>
    <span class="n">caches</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c"># Retrieve dimensions from shapes of x and parameters[&quot;Wya&quot;]</span>
    <span class="n">n_x</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">T_x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">n_y</span><span class="p">,</span> <span class="n">n_a</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s">&quot;Wya&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>

    <span class="c">### START CODE HERE ###</span>

    <span class="c"># initialize &quot;a&quot; and &quot;y&quot; with zeros (≈2 lines)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_a</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">T_x</span><span class="p">))</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">T_x</span><span class="p">))</span>

    <span class="c"># Initialize a_next (≈1 line)</span>
    <span class="n">a_next</span> <span class="o">=</span> <span class="n">a0</span>

    <span class="c"># loop over all time-steps</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T_x</span><span class="p">):</span>
        <span class="c"># Update next hidden state, compute the prediction, get the cache (≈1 line)</span>
        <span class="n">a_next</span><span class="p">,</span> <span class="n">yt_pred</span><span class="p">,</span> <span class="n">cache</span> <span class="o">=</span> <span class="n">rnn_cell_forward</span><span class="p">(</span><span class="n">x</span><span class="p">[:,:,</span><span class="n">t</span><span class="p">],</span> <span class="n">a_next</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>
        <span class="c"># Save the value of the new &quot;next&quot; hidden state in a (≈1 line)</span>
        <span class="n">a</span><span class="p">[:,:,</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_next</span>
        <span class="c"># Save the value of the prediction in y (≈1 line)</span>
        <span class="n">y_pred</span><span class="p">[:,:,</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">yt_pred</span>
        <span class="c"># Append &quot;cache&quot; to &quot;caches&quot; (≈1 line)</span>
        <span class="n">caches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span>

    <span class="c">### END CODE HERE ###</span>

    <span class="c"># store values needed for backward propagation in cache</span>
    <span class="n">caches</span> <span class="o">=</span> <span class="p">(</span><span class="n">caches</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">caches</span>
</pre></div>


<div class="hlcode"><pre><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">a0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">Waa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">Wax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">Wya</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ba</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">by</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Waa&quot;</span><span class="p">:</span> <span class="n">Waa</span><span class="p">,</span> <span class="s">&quot;Wax&quot;</span><span class="p">:</span> <span class="n">Wax</span><span class="p">,</span> <span class="s">&quot;Wya&quot;</span><span class="p">:</span> <span class="n">Wya</span><span class="p">,</span> <span class="s">&quot;ba&quot;</span><span class="p">:</span> <span class="n">ba</span><span class="p">,</span> <span class="s">&quot;by&quot;</span><span class="p">:</span> <span class="n">by</span><span class="p">}</span>

<span class="n">a</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">caches</span> <span class="o">=</span> <span class="n">rnn_forward</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;a[4][1] = &quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;a.shape = &quot;</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;y_pred[1][3] =&quot;</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;y_pred.shape = &quot;</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;caches[1][1][3] =&quot;</span><span class="p">,</span> <span class="n">caches</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;len(caches) = &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">caches</span><span class="p">))</span>
</pre></div>


<div class="hlcode"><pre><span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span><span class="o">-</span><span class="mf">0.99999375</span>  <span class="mf">0.77911235</span> <span class="o">-</span><span class="mf">0.99861469</span> <span class="o">-</span><span class="mf">0.99833267</span><span class="p">]</span>
<span class="n">a</span><span class="p">.</span><span class="n">shape</span> <span class="o">=</span>  <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">y_pred</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="mf">0.79560373</span>  <span class="mf">0.86224861</span>  <span class="mf">0.11118257</span>  <span class="mf">0.81515947</span><span class="p">]</span>
<span class="n">y_pred</span><span class="p">.</span><span class="n">shape</span> <span class="o">=</span>  <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">caches</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.1425182</span>  <span class="o">-</span><span class="mf">0.34934272</span> <span class="o">-</span><span class="mf">0.20889423</span>  <span class="mf">0.58662319</span><span class="p">]</span>
<span class="n">len</span><span class="p">(</span><span class="n">caches</span><span class="p">)</span> <span class="o">=</span>  <span class="mi">2</span>
</pre></div>


<p><strong>Expected Output</strong>:</p>
<table>
    <tr>
        <td>
            **a[4][1]**:
        </td>
        <td>
           [-0.99999375  0.77911235 -0.99861469 -0.99833267]
        </td>
    </tr>
        <tr>
        <td>
            **a.shape**:
        </td>
        <td>
           (5, 10, 4)
        </td>
    </tr>
        <tr>
        <td>
            **y[1][3]**:
        </td>
        <td>
           [ 0.79560373  0.86224861  0.11118257  0.81515947]
        </td>
    </tr>
        <tr>
        <td>
            **y.shape**:
        </td>
        <td>
           (2, 10, 4)
        </td>
    </tr>
        <tr>
        <td>
            **cache[1][1][3]**:
        </td>
        <td>
           [-1.1425182  -0.34934272 -0.20889423  0.58662319]
        </td>
    </tr>
        <tr>
        <td>
            **len(cache)**:
        </td>
        <td>
           2
        </td>
    </tr>

</table>

<p>Congratulations! You've successfully built the forward propagation of a recurrent neural network from scratch. This will work well enough for some applications, but it suffers from vanishing gradient problems. So it works best when each output $y^{\langle t \rangle}$ can be estimated using mainly "local" context (meaning information from inputs $x^{\langle t' \rangle}$ where $t'$ is not too far from $t$). </p>
<p>In the next part, you will build a more complex LSTM model, which is better at addressing vanishing gradients. The LSTM will be better able to remember a piece of information and keep it saved for many timesteps. </p>
<h2 id="2-long-short-term-memory-lstm-network">2 - Long Short-Term Memory (LSTM) network</h2>
<p>This following figure shows the operations of an LSTM-cell.</p>
<p><img src="/static/images/ML/DL/rnn/LSTM.png" style="width:500;height:400px;"><br />
<caption><center> <strong>Figure 4</strong>: LSTM-cell. This tracks and updates a "cell state" or memory variable $c^{\langle t \rangle}$ at every time-step, which can be different from $a^{\langle t \rangle}$. </center></caption></p>
<p>Similar to the RNN example above, you will start by implementing the LSTM cell for a single time-step. Then you can iteratively call it from inside a for-loop to have it process an input with $T_x$ time-steps. </p>
<h3 id="about-the-gates">About the gates</h3>
<h4 id="-forget-gate">- Forget gate</h4>
<p>For the sake of this illustration, lets assume we are reading words in a piece of text, and want use an LSTM to keep track of grammatical structures, such as whether the subject is singular or plural. If the subject changes from a singular word to a plural word, we need to find a way to get rid of our previously stored memory value of the singular/plural state. In an LSTM, the forget gate lets us do this: </p>
<p>$$\Gamma_f^{\langle t \rangle} = \sigma(W_f[a^{\langle t-1 \rangle}, x^{\langle t \rangle}] + b_f)\tag{1} $$</p>
<p>Here, $W_f$ are weights that govern the forget gate's behavior. We concatenate $[a^{\langle t-1 \rangle}, x^{\langle t \rangle}]$ and multiply by $W_f$. The equation above results in a vector $\Gamma_f^{\langle t \rangle}$ with values between 0 and 1. This forget gate vector will be multiplied element-wise by the previous cell state $c^{\langle t-1 \rangle}$. So if one of the values of $\Gamma_f^{\langle t \rangle}$ is 0 (or close to 0) then it means that the LSTM should remove that piece of information (e.g. the singular subject) in the corresponding component of $c^{\langle t-1 \rangle}$. If one of the values is 1, then it will keep the information. </p>
<h4 id="-update-gate">- Update gate</h4>
<p>Once we forget that the subject being discussed is singular, we need to find a way to update it to reflect that the new subject is now plural. Here is the formulat for the update gate: </p>
<p>$$\Gamma_u^{\langle t \rangle} = \sigma(W_u[a^{\langle t-1 \rangle}, x^{\langle t \rangle}] + b_u)\tag{2} $$ </p>
<p>Similar to the forget gate, here $\Gamma_u^{\langle t \rangle}$ is again a vector of values between 0 and 1. This will be multiplied element-wise with $\tilde{c}^{\langle t \rangle}$, in order to compute $c^{\langle t \rangle}$.</p>
<h4 id="-updating-the-cell">- Updating the cell</h4>
<p>To update the new subject we need to create a new vector of numbers that we can add to our previous cell state. The equation we use is: </p>
<p>$$ \tilde{c}^{\langle t \rangle} = \tanh(W_c[a^{\langle t-1 \rangle}, x^{\langle t \rangle}] + b_c)\tag{3} $$</p>
<p>Finally, the new cell state is: </p>
<p>$$ c^{\langle t \rangle} = \Gamma_f^{\langle t \rangle}<em> c^{\langle t-1 \rangle} + \Gamma_u^{\langle t \rangle} </em>\tilde{c}^{\langle t \rangle} \tag{4} $$</p>
<h4 id="-output-gate">- Output gate</h4>
<p>To decide which outputs we will use, we will use the following two formulas: </p>
<p>$$ \Gamma_o^{\langle t \rangle}=  \sigma(W_o[a^{\langle t-1 \rangle}, x^{\langle t \rangle}] + b_o)\tag{5}$$ <br />
$$ a^{\langle t \rangle} = \Gamma_o^{\langle t \rangle}* \tanh(c^{\langle t \rangle})\tag{6} $$</p>
<p>Where in equation 5 you decide what to output using a sigmoid function and in equation 6 you multiply that by the $\tanh$ of the previous state. </p>
<h3 id="21-lstm-cell">2.1 - LSTM cell</h3>
<p><strong>Exercise</strong>: Implement the LSTM cell described in the Figure (3).</p>
<p><strong>Instructions</strong>:<br />
1. Concatenate $a^{\langle t-1 \rangle}$ and $x^{\langle t \rangle}$ in a single matrix: $concat = \begin{bmatrix} a^{\langle t-1 \rangle} \ x^{\langle t \rangle} \end{bmatrix}$<br />
2. Compute all the formulas 1-6. You can use <code>sigmoid()</code> (provided) and <code>np.tanh()</code>.<br />
3. Compute the prediction $y^{\langle t \rangle}$. You can use <code>softmax()</code> (provided).</p>
<div class="hlcode"><pre><span class="c"># GRADED FUNCTION: lstm_cell_forward</span>

<span class="k">def</span> <span class="nf">lstm_cell_forward</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">a_prev</span><span class="p">,</span> <span class="n">c_prev</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implement a single forward step of the LSTM-cell as described in Figure (4)</span>

<span class="sd">    Arguments:</span>
<span class="sd">    xt -- your input data at timestep &quot;t&quot;, numpy array of shape (n_x, m).</span>
<span class="sd">    a_prev -- Hidden state at timestep &quot;t-1&quot;, numpy array of shape (n_a, m)</span>
<span class="sd">    c_prev -- Memory state at timestep &quot;t-1&quot;, numpy array of shape (n_a, m)</span>
<span class="sd">    parameters -- python dictionary containing:</span>
<span class="sd">                        Wf -- Weight matrix of the forget gate, numpy array of shape (n_a, n_a + n_x)</span>
<span class="sd">                        bf -- Bias of the forget gate, numpy array of shape (n_a, 1)</span>
<span class="sd">                        Wi -- Weight matrix of the update gate, numpy array of shape (n_a, n_a + n_x)</span>
<span class="sd">                        bi -- Bias of the update gate, numpy array of shape (n_a, 1)</span>
<span class="sd">                        Wc -- Weight matrix of the first &quot;tanh&quot;, numpy array of shape (n_a, n_a + n_x)</span>
<span class="sd">                        bc --  Bias of the first &quot;tanh&quot;, numpy array of shape (n_a, 1)</span>
<span class="sd">                        Wo -- Weight matrix of the output gate, numpy array of shape (n_a, n_a + n_x)</span>
<span class="sd">                        bo --  Bias of the output gate, numpy array of shape (n_a, 1)</span>
<span class="sd">                        Wy -- Weight matrix relating the hidden-state to the output, numpy array of shape (n_y, n_a)</span>
<span class="sd">                        by -- Bias relating the hidden-state to the output, numpy array of shape (n_y, 1)</span>

<span class="sd">    Returns:</span>
<span class="sd">    a_next -- next hidden state, of shape (n_a, m)</span>
<span class="sd">    c_next -- next memory state, of shape (n_a, m)</span>
<span class="sd">    yt_pred -- prediction at timestep &quot;t&quot;, numpy array of shape (n_y, m)</span>
<span class="sd">    cache -- tuple of values needed for the backward pass, contains (a_next, c_next, a_prev, c_prev, xt, parameters)</span>

<span class="sd">    Note: ft/it/ot stand for the forget/update/output gates, cct stands for the candidate value (c tilde),</span>
<span class="sd">          c stands for the memory value</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># Retrieve parameters from &quot;parameters&quot;</span>
    <span class="n">Wf</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s">&quot;Wf&quot;</span><span class="p">]</span>
    <span class="n">bf</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s">&quot;bf&quot;</span><span class="p">]</span>
    <span class="n">Wi</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s">&quot;Wi&quot;</span><span class="p">]</span>
    <span class="n">bi</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s">&quot;bi&quot;</span><span class="p">]</span>
    <span class="n">Wc</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s">&quot;Wc&quot;</span><span class="p">]</span>
    <span class="n">bc</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s">&quot;bc&quot;</span><span class="p">]</span>
    <span class="n">Wo</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s">&quot;Wo&quot;</span><span class="p">]</span>
    <span class="n">bo</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s">&quot;bo&quot;</span><span class="p">]</span>
    <span class="n">Wy</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s">&quot;Wy&quot;</span><span class="p">]</span>
    <span class="n">by</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s">&quot;by&quot;</span><span class="p">]</span>

    <span class="c"># Retrieve dimensions from shapes of xt and Wy</span>
    <span class="n">n_x</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">xt</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">n_y</span><span class="p">,</span> <span class="n">n_a</span> <span class="o">=</span> <span class="n">Wy</span><span class="o">.</span><span class="n">shape</span>

    <span class="c">### START CODE HERE ###</span>
    <span class="c"># Concatenate a_prev and xt (≈3 lines)</span>
    <span class="n">concat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_x</span> <span class="o">+</span> <span class="n">n_a</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>
    <span class="n">concat</span><span class="p">[:</span> <span class="n">n_a</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">a_prev</span>
    <span class="n">concat</span><span class="p">[</span><span class="n">n_a</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">xt</span>

    <span class="c"># Compute values for ft, it, cct, c_next, ot, a_next using the formulas given figure (4) (≈6 lines)</span>
    <span class="n">ft</span> <span class="o">=</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Wf</span><span class="p">,</span> <span class="n">concat</span><span class="p">)</span> <span class="o">+</span> <span class="n">bf</span><span class="p">)</span>
    <span class="n">it</span> <span class="o">=</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Wi</span><span class="p">,</span> <span class="n">concat</span><span class="p">)</span> <span class="o">+</span> <span class="n">bi</span><span class="p">)</span>
    <span class="n">cct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Wc</span><span class="p">,</span> <span class="n">concat</span><span class="p">)</span> <span class="o">+</span> <span class="n">bc</span><span class="p">)</span>
    <span class="n">c_next</span> <span class="o">=</span> <span class="n">ft</span> <span class="o">*</span> <span class="n">c_prev</span> <span class="o">+</span> <span class="n">it</span> <span class="o">*</span> <span class="n">cct</span>
    <span class="n">ot</span> <span class="o">=</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Wo</span><span class="p">,</span> <span class="n">concat</span><span class="p">)</span> <span class="o">+</span> <span class="n">bo</span><span class="p">)</span>
    <span class="n">a_next</span> <span class="o">=</span> <span class="n">ot</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">c_next</span><span class="p">)</span>

    <span class="c"># Compute prediction of the LSTM cell (≈1 line)</span>
    <span class="n">yt_pred</span> <span class="o">=</span> <span class="n">softmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Wy</span><span class="p">,</span> <span class="n">a_next</span><span class="p">)</span> <span class="o">+</span> <span class="n">by</span><span class="p">)</span>
    <span class="c">### END CODE HERE ###</span>

    <span class="c"># store values needed for backward propagation in cache</span>
    <span class="n">cache</span> <span class="o">=</span> <span class="p">(</span><span class="n">a_next</span><span class="p">,</span> <span class="n">c_next</span><span class="p">,</span> <span class="n">a_prev</span><span class="p">,</span> <span class="n">c_prev</span><span class="p">,</span> <span class="n">ft</span><span class="p">,</span> <span class="n">it</span><span class="p">,</span> <span class="n">cct</span><span class="p">,</span> <span class="n">ot</span><span class="p">,</span> <span class="n">xt</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">a_next</span><span class="p">,</span> <span class="n">c_next</span><span class="p">,</span> <span class="n">yt_pred</span><span class="p">,</span> <span class="n">cache</span>
</pre></div>


<div class="hlcode"><pre><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">xt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">a_prev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">c_prev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">Wf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>
<span class="n">bf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Wi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>
<span class="n">bi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Wo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>
<span class="n">bo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Wc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>
<span class="n">bc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Wy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">by</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Wf&quot;</span><span class="p">:</span> <span class="n">Wf</span><span class="p">,</span> <span class="s">&quot;Wi&quot;</span><span class="p">:</span> <span class="n">Wi</span><span class="p">,</span> <span class="s">&quot;Wo&quot;</span><span class="p">:</span> <span class="n">Wo</span><span class="p">,</span> <span class="s">&quot;Wc&quot;</span><span class="p">:</span> <span class="n">Wc</span><span class="p">,</span> <span class="s">&quot;Wy&quot;</span><span class="p">:</span> <span class="n">Wy</span><span class="p">,</span> <span class="s">&quot;bf&quot;</span><span class="p">:</span> <span class="n">bf</span><span class="p">,</span> <span class="s">&quot;bi&quot;</span><span class="p">:</span> <span class="n">bi</span><span class="p">,</span> <span class="s">&quot;bo&quot;</span><span class="p">:</span> <span class="n">bo</span><span class="p">,</span> <span class="s">&quot;bc&quot;</span><span class="p">:</span> <span class="n">bc</span><span class="p">,</span> <span class="s">&quot;by&quot;</span><span class="p">:</span> <span class="n">by</span><span class="p">}</span>

<span class="n">a_next</span><span class="p">,</span> <span class="n">c_next</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="n">cache</span> <span class="o">=</span> <span class="n">lstm_cell_forward</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">a_prev</span><span class="p">,</span> <span class="n">c_prev</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;a_next[4] = &quot;</span><span class="p">,</span> <span class="n">a_next</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;a_next.shape = &quot;</span><span class="p">,</span> <span class="n">c_next</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;c_next[2] = &quot;</span><span class="p">,</span> <span class="n">c_next</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;c_next.shape = &quot;</span><span class="p">,</span> <span class="n">c_next</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;yt[1] =&quot;</span><span class="p">,</span> <span class="n">yt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;yt.shape = &quot;</span><span class="p">,</span> <span class="n">yt</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;cache[1][3] =&quot;</span><span class="p">,</span> <span class="n">cache</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;len(cache) = &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cache</span><span class="p">))</span>
</pre></div>


<div class="hlcode"><pre><span class="n">a_next</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span><span class="o">-</span><span class="mf">0.66408471</span>  <span class="mf">0.0036921</span>   <span class="mf">0.02088357</span>  <span class="mf">0.22834167</span> <span class="o">-</span><span class="mf">0.85575339</span>  <span class="mf">0.00138482</span>
  <span class="mf">0.76566531</span>  <span class="mf">0.34631421</span> <span class="o">-</span><span class="mf">0.00215674</span>  <span class="mf">0.43827275</span><span class="p">]</span>
<span class="n">a_next</span><span class="p">.</span><span class="n">shape</span> <span class="o">=</span>  <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">c_next</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span> <span class="mf">0.63267805</span>  <span class="mf">1.00570849</span>  <span class="mf">0.35504474</span>  <span class="mf">0.20690913</span> <span class="o">-</span><span class="mf">1.64566718</span>  <span class="mf">0.11832942</span>
  <span class="mf">0.76449811</span> <span class="o">-</span><span class="mf">0.0981561</span>  <span class="o">-</span><span class="mf">0.74348425</span> <span class="o">-</span><span class="mf">0.26810932</span><span class="p">]</span>
<span class="n">c_next</span><span class="p">.</span><span class="n">shape</span> <span class="o">=</span>  <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">yt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="mf">0.79913913</span>  <span class="mf">0.15986619</span>  <span class="mf">0.22412122</span>  <span class="mf">0.15606108</span>  <span class="mf">0.97057211</span>  <span class="mf">0.31146381</span>
  <span class="mf">0.00943007</span>  <span class="mf">0.12666353</span>  <span class="mf">0.39380172</span>  <span class="mf">0.07828381</span><span class="p">]</span>
<span class="n">yt</span><span class="p">.</span><span class="n">shape</span> <span class="o">=</span>  <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">cache</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.16263996</span>  <span class="mf">1.03729328</span>  <span class="mf">0.72938082</span> <span class="o">-</span><span class="mf">0.54101719</span>  <span class="mf">0.02752074</span> <span class="o">-</span><span class="mf">0.30821874</span>
  <span class="mf">0.07651101</span> <span class="o">-</span><span class="mf">1.03752894</span>  <span class="mf">1.41219977</span> <span class="o">-</span><span class="mf">0.37647422</span><span class="p">]</span>
<span class="n">len</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span> <span class="o">=</span>  <span class="mi">10</span>
</pre></div>


<p><strong>Expected Output</strong>:</p>
<table>
    <tr>
        <td>
            **a_next[4]**:
        </td>
        <td>
           [-0.66408471  0.0036921   0.02088357  0.22834167 -0.85575339  0.00138482
  0.76566531  0.34631421 -0.00215674  0.43827275]
        </td>
    </tr>
        <tr>
        <td>
            **a_next.shape**:
        </td>
        <td>
           (5, 10)
        </td>
    </tr>
        <tr>
        <td>
            **c_next[2]**:
        </td>
        <td>
           [ 0.63267805  1.00570849  0.35504474  0.20690913 -1.64566718  0.11832942
  0.76449811 -0.0981561  -0.74348425 -0.26810932]
        </td>
    </tr>
        <tr>
        <td>
            **c_next.shape**:
        </td>
        <td>
           (5, 10)
        </td>
    </tr>
        <tr>
        <td>
            **yt[1]**:
        </td>
        <td>
           [ 0.79913913  0.15986619  0.22412122  0.15606108  0.97057211  0.31146381
  0.00943007  0.12666353  0.39380172  0.07828381]
        </td>
    </tr>
        <tr>
        <td>
            **yt.shape**:
        </td>
        <td>
           (2, 10)
        </td>
    </tr>
    <tr>
        <td>
            **cache[1][3]**:
        </td>
        <td>
           [-0.16263996  1.03729328  0.72938082 -0.54101719  0.02752074 -0.30821874
  0.07651101 -1.03752894  1.41219977 -0.37647422]
        </td>
    </tr>
        <tr>
        <td>
            **len(cache)**:
        </td>
        <td>
           10
        </td>
    </tr>

</table>

<h3 id="22-forward-pass-for-lstm">2.2 - Forward pass for LSTM</h3>
<p>Now that you have implemented one step of an LSTM, you can now iterate this over this using a for-loop to process a sequence of $T_x$ inputs. </p>
<p><img src="/static/images/ML/DL/rnn/LSTM_rnn.png" style="width:500;height:300px;"><br />
<caption><center> <strong>Figure 4</strong>: LSTM over multiple time-steps. </center></caption></p>
<p><strong>Exercise:</strong> Implement <code>lstm_forward()</code> to run an LSTM over $T_x$ time-steps. </p>
<p><strong>Note</strong>: $c^{\langle 0 \rangle}$ is initialized with zeros.</p>
<div class="hlcode"><pre><span class="c"># GRADED FUNCTION: lstm_forward</span>

<span class="k">def</span> <span class="nf">lstm_forward</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implement the forward propagation of the recurrent neural network using an LSTM-cell described in Figure (3).</span>

<span class="sd">    Arguments:</span>
<span class="sd">    x -- Input data for every time-step, of shape (n_x, m, T_x).</span>
<span class="sd">    a0 -- Initial hidden state, of shape (n_a, m)</span>
<span class="sd">    parameters -- python dictionary containing:</span>
<span class="sd">                        Wf -- Weight matrix of the forget gate, numpy array of shape (n_a, n_a + n_x)</span>
<span class="sd">                        bf -- Bias of the forget gate, numpy array of shape (n_a, 1)</span>
<span class="sd">                        Wi -- Weight matrix of the update gate, numpy array of shape (n_a, n_a + n_x)</span>
<span class="sd">                        bi -- Bias of the update gate, numpy array of shape (n_a, 1)</span>
<span class="sd">                        Wc -- Weight matrix of the first &quot;tanh&quot;, numpy array of shape (n_a, n_a + n_x)</span>
<span class="sd">                        bc -- Bias of the first &quot;tanh&quot;, numpy array of shape (n_a, 1)</span>
<span class="sd">                        Wo -- Weight matrix of the output gate, numpy array of shape (n_a, n_a + n_x)</span>
<span class="sd">                        bo -- Bias of the output gate, numpy array of shape (n_a, 1)</span>
<span class="sd">                        Wy -- Weight matrix relating the hidden-state to the output, numpy array of shape (n_y, n_a)</span>
<span class="sd">                        by -- Bias relating the hidden-state to the output, numpy array of shape (n_y, 1)</span>

<span class="sd">    Returns:</span>
<span class="sd">    a -- Hidden states for every time-step, numpy array of shape (n_a, m, T_x)</span>
<span class="sd">    y -- Predictions for every time-step, numpy array of shape (n_y, m, T_x)</span>
<span class="sd">    caches -- tuple of values needed for the backward pass, contains (list of all the caches, x)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># Initialize &quot;caches&quot;, which will track the list of all the caches</span>
    <span class="n">caches</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c">### START CODE HERE ###</span>
    <span class="c"># Retrieve dimensions from shapes of x and parameters[&#39;Wy&#39;] (≈2 lines)</span>
    <span class="n">n_x</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">T_x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">n_y</span><span class="p">,</span> <span class="n">n_a</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s">&quot;Wy&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>

    <span class="c"># initialize &quot;a&quot;, &quot;c&quot; and &quot;y&quot; with zeros (≈3 lines)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_a</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">T_x</span><span class="p">))</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_a</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">T_x</span><span class="p">))</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">T_x</span><span class="p">))</span>

    <span class="c"># Initialize a_next and c_next (≈2 lines)</span>
    <span class="n">a_next</span> <span class="o">=</span> <span class="n">a0</span>
    <span class="n">c_next</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_a</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>

    <span class="c"># loop over all time-steps</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T_x</span><span class="p">):</span>
        <span class="c"># Update next hidden state, next memory state, compute the prediction, get the cache (≈1 line)</span>
        <span class="n">a_next</span><span class="p">,</span> <span class="n">c_next</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="n">cache</span> <span class="o">=</span> <span class="n">lstm_cell_forward</span><span class="p">(</span><span class="n">x</span><span class="p">[:,:,</span><span class="n">t</span><span class="p">],</span> <span class="n">a_next</span><span class="p">,</span> <span class="n">c_next</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>
        <span class="c"># Save the value of the new &quot;next&quot; hidden state in a (≈1 line)</span>
        <span class="n">a</span><span class="p">[:,:,</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_next</span>
        <span class="c"># Save the value of the prediction in y (≈1 line)</span>
        <span class="n">y</span><span class="p">[:,:,</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">yt</span>
        <span class="c"># Save the value of the next cell state (≈1 line)</span>
        <span class="n">c</span><span class="p">[:,:,</span><span class="n">t</span><span class="p">]</span>  <span class="o">=</span> <span class="n">c_next</span>
        <span class="c"># Append the cache into caches (≈1 line)</span>
        <span class="n">caches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span>

    <span class="c">### END CODE HERE ###</span>

    <span class="c"># store values needed for backward propagation in cache</span>
    <span class="n">caches</span> <span class="o">=</span> <span class="p">(</span><span class="n">caches</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">caches</span>
</pre></div>


<div class="hlcode"><pre><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
<span class="n">a0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">Wf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>
<span class="n">bf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Wi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>
<span class="n">bi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Wo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>
<span class="n">bo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Wc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>
<span class="n">bc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Wy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">by</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Wf&quot;</span><span class="p">:</span> <span class="n">Wf</span><span class="p">,</span> <span class="s">&quot;Wi&quot;</span><span class="p">:</span> <span class="n">Wi</span><span class="p">,</span> <span class="s">&quot;Wo&quot;</span><span class="p">:</span> <span class="n">Wo</span><span class="p">,</span> <span class="s">&quot;Wc&quot;</span><span class="p">:</span> <span class="n">Wc</span><span class="p">,</span> <span class="s">&quot;Wy&quot;</span><span class="p">:</span> <span class="n">Wy</span><span class="p">,</span> <span class="s">&quot;bf&quot;</span><span class="p">:</span> <span class="n">bf</span><span class="p">,</span> <span class="s">&quot;bi&quot;</span><span class="p">:</span> <span class="n">bi</span><span class="p">,</span> <span class="s">&quot;bo&quot;</span><span class="p">:</span> <span class="n">bo</span><span class="p">,</span> <span class="s">&quot;bc&quot;</span><span class="p">:</span> <span class="n">bc</span><span class="p">,</span> <span class="s">&quot;by&quot;</span><span class="p">:</span> <span class="n">by</span><span class="p">}</span>

<span class="n">a</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">caches</span> <span class="o">=</span> <span class="n">lstm_forward</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;a[4][3][6] = &quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="mi">6</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;a.shape = &quot;</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;y[1][4][3] =&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">4</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;y.shape = &quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;caches[1][1[1]] =&quot;</span><span class="p">,</span> <span class="n">caches</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;c[1][2][1]&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;len(caches) = &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">caches</span><span class="p">))</span>
</pre></div>


<div class="hlcode"><pre><span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">0.172117767533</span>
<span class="n">a</span><span class="p">.</span><span class="n">shape</span> <span class="o">=</span>  <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">4</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.95087346185</span>
<span class="n">y</span><span class="p">.</span><span class="n">shape</span> <span class="o">=</span>  <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">caches</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span> <span class="mf">0.82797464</span>  <span class="mf">0.23009474</span>  <span class="mf">0.76201118</span> <span class="o">-</span><span class="mf">0.22232814</span> <span class="o">-</span><span class="mf">0.20075807</span>  <span class="mf">0.18656139</span>
  <span class="mf">0.41005165</span><span class="p">]</span>
<span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span><span class="mf">0.855544916718</span>
<span class="n">len</span><span class="p">(</span><span class="n">caches</span><span class="p">)</span> <span class="o">=</span>  <span class="mi">2</span>
</pre></div>


<p><strong>Expected Output</strong>:</p>
<table>
    <tr>
        <td>
            **a[4][3][6]** =
        </td>
        <td>
           0.172117767533
        </td>
    </tr>
        <tr>
        <td>
            **a.shape** =
        </td>
        <td>
           (5, 10, 7)
        </td>
    </tr>
        <tr>
        <td>
            **y[1][4][3]** =
        </td>
        <td>
           0.95087346185
        </td>
    </tr>
        <tr>
        <td>
            **y.shape** =
        </td>
        <td>
           (2, 10, 7)
        </td>
    </tr>
        <tr>
        <td>
            **caches[1][1][1]** =
        </td>
        <td>
           [ 0.82797464  0.23009474  0.76201118 -0.22232814 -0.20075807  0.18656139
  0.41005165]
        </td>

     </tr>
        <tr>
        <td>
            **c[1][2][1]** =
        </td>
        <td>
           -0.855544916718
        </td>
    </tr>       

    </tr>
        <tr>
        <td>
            **len(caches)** =
        </td>
        <td>
           2
        </td>
    </tr>

</table>

<p>Congratulations! You have now implemented the forward passes for the basic RNN and the LSTM. When using a deep learning framework, implementing the forward pass is sufficient to build systems that achieve great performance. </p>
<p>The rest of this notebook is optional, and will not be graded.</p>
<h2 id="3-backpropagation-in-recurrent-neural-networks-optional-ungraded">3 - Backpropagation in recurrent neural networks (OPTIONAL / UNGRADED)</h2>
<p>In modern deep learning frameworks, you only have to implement the forward pass, and the framework takes care of the backward pass, so most deep learning engineers do not need to bother with the details of the backward pass. If however you are an expert in calculus and want to see the details of backprop in RNNs, you can work through this optional portion of the notebook. </p>
<p>When in an earlier course you implemented a simple (fully connected) neural network, you used backpropagation to compute the derivatives with respect to the cost to update the parameters. Similarly, in recurrent neural networks you can to calculate the derivatives with respect to the cost in order to update the parameters. The backprop equations are quite complicated and we did not derive them in lecture. However, we will briefly present them below. </p>
<h3 id="31-basic-rnn-backward-pass">3.1 - Basic RNN  backward pass</h3>
<p>We will start by computing the backward pass for the basic RNN-cell.</p>
<p><img src="/static/images/ML/DL/rnn/rnn_cell_backprop.png" style="width:500;height:300px;"> <br><br />
<caption><center> <strong>Figure 5</strong>: RNN-cell's backward pass. Just like in a fully-connected neural network, the derivative of the cost function $J$ backpropagates through the RNN by following the chain-rule from calculas. The chain-rule is also used to calculate $(\frac{\partial J}{\partial W_{ax}},\frac{\partial J}{\partial W_{aa}},\frac{\partial J}{\partial b})$ to update the parameters $(W_{ax}, W_{aa}, b_a)$. </center></caption></p>
<h4 id="deriving-the-one-step-backward-functions">Deriving the one step backward functions:</h4>
<p>To compute the <code>rnn_cell_backward</code> you need to compute the following equations. It is a good exercise to derive them by hand. </p>
<p>The derivative of $\tanh$ is $1-\tanh(x)^2$. You can find the complete proof <a href="https://www.wyzant.com/resources/lessons/math/calculus/derivative_proofs/tanx">here</a>. Note that: $ \text{sech}(x)^2 = 1 - \tanh(x)^2$</p>
<p>Similarly for $\frac{ \partial a^{\langle t \rangle} } {\partial W_{ax}}, \frac{ \partial a^{\langle t \rangle} } {\partial W_{aa}},  \frac{ \partial a^{\langle t \rangle} } {\partial b}$, the derivative of  $\tanh(u)$ is $(1-\tanh(u)^2)du$. </p>
<p>The final two equations also follow same rule and are derived using the $\tanh$ derivative. Note that the arrangement is done in a way to get the same dimensions to match.</p>
<div class="hlcode"><pre><span class="k">def</span> <span class="nf">rnn_cell_backward</span><span class="p">(</span><span class="n">da_next</span><span class="p">,</span> <span class="n">cache</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implements the backward pass for the RNN-cell (single time-step).</span>

<span class="sd">    Arguments:</span>
<span class="sd">    da_next -- Gradient of loss with respect to next hidden state</span>
<span class="sd">    cache -- python dictionary containing useful values (output of rnn_cell_forward())</span>

<span class="sd">    Returns:</span>
<span class="sd">    gradients -- python dictionary containing:</span>
<span class="sd">                        dx -- Gradients of input data, of shape (n_x, m)</span>
<span class="sd">                        da_prev -- Gradients of previous hidden state, of shape (n_a, m)</span>
<span class="sd">                        dWax -- Gradients of input-to-hidden weights, of shape (n_a, n_x)</span>
<span class="sd">                        dWaa -- Gradients of hidden-to-hidden weights, of shape (n_a, n_a)</span>
<span class="sd">                        dba -- Gradients of bias vector, of shape (n_a, 1)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># Retrieve values from cache</span>
    <span class="p">(</span><span class="n">a_next</span><span class="p">,</span> <span class="n">a_prev</span><span class="p">,</span> <span class="n">xt</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span> <span class="o">=</span> <span class="n">cache</span>

    <span class="c"># Retrieve values from parameters</span>
    <span class="n">Wax</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s">&quot;Wax&quot;</span><span class="p">]</span>
    <span class="n">Waa</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s">&quot;Waa&quot;</span><span class="p">]</span>
    <span class="n">Wya</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s">&quot;Wya&quot;</span><span class="p">]</span>
    <span class="n">ba</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s">&quot;ba&quot;</span><span class="p">]</span>
    <span class="n">by</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s">&quot;by&quot;</span><span class="p">]</span>

    <span class="c">### START CODE HERE ###</span>
    <span class="c"># compute the gradient of tanh with respect to a_next (≈1 line)</span>
    <span class="n">dtanh</span> <span class="o">=</span> <span class="n">da_next</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a_next</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c"># compute the gradient of the loss with respect to Wax (≈2 lines)</span>
    <span class="n">dxt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Wax</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">dtanh</span><span class="p">)</span>
    <span class="n">dWax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dtanh</span><span class="p">,</span> <span class="n">xt</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

    <span class="c"># compute the gradient with respect to Waa (≈2 lines)</span>
    <span class="n">da_prev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Waa</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">dtanh</span><span class="p">)</span>
    <span class="n">dWaa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dtanh</span><span class="p">,</span> <span class="n">a_prev</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

    <span class="c"># compute the gradient with respect to b (≈1 line)</span>
    <span class="n">dba</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dtanh</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="c">### END CODE HERE ###</span>

    <span class="c"># Store the gradients in a python dictionary</span>
    <span class="n">gradients</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;dxt&quot;</span><span class="p">:</span> <span class="n">dxt</span><span class="p">,</span> <span class="s">&quot;da_prev&quot;</span><span class="p">:</span> <span class="n">da_prev</span><span class="p">,</span> <span class="s">&quot;dWax&quot;</span><span class="p">:</span> <span class="n">dWax</span><span class="p">,</span> <span class="s">&quot;dWaa&quot;</span><span class="p">:</span> <span class="n">dWaa</span><span class="p">,</span> <span class="s">&quot;dba&quot;</span><span class="p">:</span> <span class="n">dba</span><span class="p">}</span>

    <span class="k">return</span> <span class="n">gradients</span>
</pre></div>


<div class="hlcode"><pre><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">xt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">a_prev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">Wax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">Waa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">Wya</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">by</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Wax&quot;</span><span class="p">:</span> <span class="n">Wax</span><span class="p">,</span> <span class="s">&quot;Waa&quot;</span><span class="p">:</span> <span class="n">Waa</span><span class="p">,</span> <span class="s">&quot;Wya&quot;</span><span class="p">:</span> <span class="n">Wya</span><span class="p">,</span> <span class="s">&quot;ba&quot;</span><span class="p">:</span> <span class="n">ba</span><span class="p">,</span> <span class="s">&quot;by&quot;</span><span class="p">:</span> <span class="n">by</span><span class="p">}</span>

<span class="n">a_next</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="n">cache</span> <span class="o">=</span> <span class="n">rnn_cell_forward</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">a_prev</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>

<span class="n">da_next</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">gradients</span> <span class="o">=</span> <span class="n">rnn_cell_backward</span><span class="p">(</span><span class="n">da_next</span><span class="p">,</span> <span class="n">cache</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dxt</span><span class="se">\&quot;</span><span class="s">][1][2] =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dxt&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dxt</span><span class="se">\&quot;</span><span class="s">].shape =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dxt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">da_prev</span><span class="se">\&quot;</span><span class="s">][2][3] =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;da_prev&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">da_prev</span><span class="se">\&quot;</span><span class="s">].shape =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;da_prev&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dWax</span><span class="se">\&quot;</span><span class="s">][3][1] =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dWax&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dWax</span><span class="se">\&quot;</span><span class="s">].shape =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dWax&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dWaa</span><span class="se">\&quot;</span><span class="s">][1][2] =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dWaa&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dWaa</span><span class="se">\&quot;</span><span class="s">].shape =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dWaa&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dba</span><span class="se">\&quot;</span><span class="s">][4] =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dba&quot;</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dba</span><span class="se">\&quot;</span><span class="s">].shape =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dba&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>


<p><strong>Expected Output</strong>:</p>
<table>
    <tr>
        <td>
            **gradients["dxt"][1][2]** =
        </td>
        <td>
           -0.460564103059
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dxt"].shape** =
        </td>
        <td>
           (3, 10)
        </td>
    </tr>
        <tr>
        <td>
            **gradients["da_prev"][2][3]** =
        </td>
        <td>
           0.0842968653807
        </td>
    </tr>
        <tr>
        <td>
            **gradients["da_prev"].shape** =
        </td>
        <td>
           (5, 10)
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dWax"][3][1]** =
        </td>
        <td>
           0.393081873922
        </td>
    </tr>
            <tr>
        <td>
            **gradients["dWax"].shape** =
        </td>
        <td>
           (5, 3)
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dWaa"][1][2]** = 
        </td>
        <td>
           -0.28483955787
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dWaa"].shape** =
        </td>
        <td>
           (5, 5)
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dba"][4]** = 
        </td>
        <td>
           [ 0.80517166]
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dba"].shape** = 
        </td>
        <td>
           (5, 1)
        </td>
    </tr>
</table>

<h4 id="backward-pass-through-the-rnn">Backward pass through the RNN</h4>
<p>Computing the gradients of the cost with respect to $a^{\langle t \rangle}$ at every time-step $t$ is useful because it is what helps the gradient backpropagate to the previous RNN-cell. To do so, you need to iterate through all the time steps starting at the end, and at each step, you increment the overall $db_a$, $dW_{aa}$, $dW_{ax}$ and you store $dx$.</p>
<p><strong>Instructions</strong>:</p>
<p>Implement the <code>rnn_backward</code> function. Initialize the return variables with zeros first and then loop through all the time steps while calling the <code>rnn_cell_backward</code> at each time timestep, update the other variables accordingly.</p>
<div class="hlcode"><pre><span class="k">def</span> <span class="nf">rnn_backward</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">caches</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implement the backward pass for a RNN over an entire sequence of input data.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    da -- Upstream gradients of all hidden states, of shape (n_a, m, T_x)</span>
<span class="sd">    caches -- tuple containing information from the forward pass (rnn_forward)</span>

<span class="sd">    Returns:</span>
<span class="sd">    gradients -- python dictionary containing:</span>
<span class="sd">                        dx -- Gradient w.r.t. the input data, numpy-array of shape (n_x, m, T_x)</span>
<span class="sd">                        da0 -- Gradient w.r.t the initial hidden state, numpy-array of shape (n_a, m)</span>
<span class="sd">                        dWax -- Gradient w.r.t the input&#39;s weight matrix, numpy-array of shape (n_a, n_x)</span>
<span class="sd">                        dWaa -- Gradient w.r.t the hidden state&#39;s weight matrix, numpy-arrayof shape (n_a, n_a)</span>
<span class="sd">                        dba -- Gradient w.r.t the bias, of shape (n_a, 1)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c">### START CODE HERE ###</span>

    <span class="c"># Retrieve values from the first cache (t=1) of caches (≈2 lines)</span>
    <span class="p">(</span><span class="n">caches</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="n">caches</span>
    <span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span> <span class="o">=</span> <span class="n">caches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c"># Retrieve dimensions from da&#39;s and x1&#39;s shapes (≈2 lines)</span>
    <span class="n">n_a</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">T_x</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">n_x</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">x1</span><span class="o">.</span><span class="n">shape</span>

    <span class="c"># initialize the gradients with the right sizes (≈6 lines)</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_x</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">T_x</span><span class="p">))</span>
    <span class="n">dWax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s">&quot;Wax&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">dWaa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s">&quot;Waa&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">dba</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s">&quot;ba&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">da0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">a0</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">da_prevt</span> <span class="o">=</span> <span class="n">da</span><span class="p">[:,:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c"># Loop through all the time steps</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T_x</span><span class="p">)):</span>
        <span class="c"># Compute gradients at time step t. Choose wisely the &quot;da_next&quot; and the &quot;cache&quot; to use in the backward propagation step. (≈1 line)</span>
        <span class="n">gradients</span> <span class="o">=</span> <span class="n">rnn_cell_backward</span><span class="p">(</span><span class="n">da_prevt</span><span class="p">,</span> <span class="n">caches</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
        <span class="c"># Retrieve derivatives from gradients (≈ 1 line)</span>
        <span class="n">dxt</span><span class="p">,</span> <span class="n">da_prevt</span><span class="p">,</span> <span class="n">dWaxt</span><span class="p">,</span> <span class="n">dWaat</span><span class="p">,</span> <span class="n">dbat</span> <span class="o">=</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dxt&quot;</span><span class="p">],</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;da_prev&quot;</span><span class="p">],</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dWax&quot;</span><span class="p">],</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dWaa&quot;</span><span class="p">],</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dba&quot;</span><span class="p">]</span>
        <span class="c"># Increment global derivatives w.r.t parameters by adding their derivative at time-step t (≈4 lines)</span>
        <span class="n">dx</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">dxt</span>
        <span class="n">dWax</span> <span class="o">+=</span> <span class="n">dWaxt</span>
        <span class="n">dWaa</span> <span class="o">+=</span> <span class="n">dWaat</span>
        <span class="n">dba</span> <span class="o">+=</span> <span class="n">dbat</span>

    <span class="c"># Set da0 to the gradient of a which has been backpropagated through all time-steps (≈1 line) </span>
    <span class="n">da0</span> <span class="o">=</span> <span class="n">da_prevt</span>
    <span class="c">### END CODE HERE ###</span>

    <span class="c"># Store the gradients in a python dictionary</span>
    <span class="n">gradients</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;dx&quot;</span><span class="p">:</span> <span class="n">dx</span><span class="p">,</span> <span class="s">&quot;da0&quot;</span><span class="p">:</span> <span class="n">da0</span><span class="p">,</span> <span class="s">&quot;dWax&quot;</span><span class="p">:</span> <span class="n">dWax</span><span class="p">,</span> <span class="s">&quot;dWaa&quot;</span><span class="p">:</span> <span class="n">dWaa</span><span class="p">,</span><span class="s">&quot;dba&quot;</span><span class="p">:</span> <span class="n">dba</span><span class="p">}</span>

    <span class="k">return</span> <span class="n">gradients</span>
</pre></div>


<div class="hlcode"><pre><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">a0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">Wax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">Waa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">Wya</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ba</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">by</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Wax&quot;</span><span class="p">:</span> <span class="n">Wax</span><span class="p">,</span> <span class="s">&quot;Waa&quot;</span><span class="p">:</span> <span class="n">Waa</span><span class="p">,</span> <span class="s">&quot;Wya&quot;</span><span class="p">:</span> <span class="n">Wya</span><span class="p">,</span> <span class="s">&quot;ba&quot;</span><span class="p">:</span> <span class="n">ba</span><span class="p">,</span> <span class="s">&quot;by&quot;</span><span class="p">:</span> <span class="n">by</span><span class="p">}</span>
<span class="n">a</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">caches</span> <span class="o">=</span> <span class="n">rnn_forward</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>
<span class="n">da</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">gradients</span> <span class="o">=</span> <span class="n">rnn_backward</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">caches</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dx</span><span class="se">\&quot;</span><span class="s">][1][2] =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dx&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dx</span><span class="se">\&quot;</span><span class="s">].shape =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dx&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">da0</span><span class="se">\&quot;</span><span class="s">][2][3] =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;da0&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">da0</span><span class="se">\&quot;</span><span class="s">].shape =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;da0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dWax</span><span class="se">\&quot;</span><span class="s">][3][1] =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dWax&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dWax</span><span class="se">\&quot;</span><span class="s">].shape =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dWax&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dWaa</span><span class="se">\&quot;</span><span class="s">][1][2] =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dWaa&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dWaa</span><span class="se">\&quot;</span><span class="s">].shape =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dWaa&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dba</span><span class="se">\&quot;</span><span class="s">][4] =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dba&quot;</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dba</span><span class="se">\&quot;</span><span class="s">].shape =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dba&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>


<div class="hlcode"><pre><span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dx&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="mf">0.04036334</span>  <span class="mf">0.01590669</span>  <span class="mf">0.00395097</span>  <span class="mf">0.01483317</span><span class="p">]</span>
<span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dx&quot;</span><span class="p">].</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">gradients</span><span class="p">[</span><span class="s">&quot;da0&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.000705301629139</span>
<span class="n">gradients</span><span class="p">[</span><span class="s">&quot;da0&quot;</span><span class="p">].</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dWax&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">8.45242637129</span>
<span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dWax&quot;</span><span class="p">].</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dWaa&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.27076517994</span>
<span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dWaa&quot;</span><span class="p">].</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dba&quot;</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.50815277</span><span class="p">]</span>
<span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dba&quot;</span><span class="p">].</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>


<p><strong>Expected Output</strong>:</p>
<table>
    <tr>
        <td>
            **gradients["dx"][1][2]** =
        </td>
        <td>
           [-2.07101689 -0.59255627  0.02466855  0.01483317]
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dx"].shape** =
        </td>
        <td>
           (3, 10, 4)
        </td>
    </tr>
        <tr>
        <td>
            **gradients["da0"][2][3]** =
        </td>
        <td>
           -0.314942375127
        </td>
    </tr>
        <tr>
        <td>
            **gradients["da0"].shape** =
        </td>
        <td>
           (5, 10)
        </td>
    </tr>
         <tr>
        <td>
            **gradients["dWax"][3][1]** =
        </td>
        <td>
           11.2641044965
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dWax"].shape** =
        </td>
        <td>
           (5, 3)
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dWaa"][1][2]** = 
        </td>
        <td>
           2.30333312658
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dWaa"].shape** =
        </td>
        <td>
           (5, 5)
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dba"][4]** = 
        </td>
        <td>
           [-0.74747722]
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dba"].shape** = 
        </td>
        <td>
           (5, 1)
        </td>
    </tr>
</table>

<h2 id="32-lstm-backward-pass">3.2 - LSTM backward pass</h2>
<h3 id="321-one-step-backward">3.2.1 One Step backward</h3>
<p>The LSTM backward pass is slighltly more complicated than the forward one. We have provided you with all the equations for the LSTM backward pass below. (If you enjoy calculus exercises feel free to try deriving these from scratch yourself.) </p>
<h3 id="322-gate-derivatives">3.2.2 gate derivatives</h3>
<p>$$d \Gamma_o^{\langle t \rangle} = da_{next}<em>\tanh(c_{next}) * \Gamma_o^{\langle t \rangle}</em>(1-\Gamma_o^{\langle t \rangle})\tag{7}$$</p>
<p>$$d\tilde c^{\langle t \rangle} = dc_{next}*\Gamma_u^{\langle t \rangle}+ \Gamma_o^{\langle t \rangle} (1-\tanh(c_{next})^2) * i_t * da_{next} * \tilde c^{\langle t \rangle} * (1-\tanh(\tilde c)^2) \tag{8}$$</p>
<p>$$d\Gamma_u^{\langle t \rangle} = dc_{next}<em>\tilde c^{\langle t \rangle} + \Gamma_o^{\langle t \rangle} (1-\tanh(c_{next})^2) * \tilde c^{\langle t \rangle} * da_{next}</em>\Gamma_u^{\langle t \rangle}*(1-\Gamma_u^{\langle t \rangle})\tag{9}$$</p>
<p>$$d\Gamma_f^{\langle t \rangle} = dc_{next}<em>\tilde c_{prev} + \Gamma_o^{\langle t \rangle} (1-\tanh(c_{next})^2) * c_{prev} * da_{next}</em>\Gamma_f^{\langle t \rangle}*(1-\Gamma_f^{\langle t \rangle})\tag{10}$$</p>
<h3 id="323-parameter-derivatives">3.2.3 parameter derivatives</h3>
<p>$$ dW_f = d\Gamma_f^{\langle t \rangle} * \begin{pmatrix} a_{prev} \ x_t\end{pmatrix}^T \tag{11} $$<br />
$$ dW_u = d\Gamma_u^{\langle t \rangle} * \begin{pmatrix} a_{prev} \ x_t\end{pmatrix}^T \tag{12} $$<br />
$$ dW_c = d\tilde c^{\langle t \rangle} * \begin{pmatrix} a_{prev} \ x_t\end{pmatrix}^T \tag{13} $$<br />
$$ dW_o = d\Gamma_o^{\langle t \rangle} * \begin{pmatrix} a_{prev} \ x_t\end{pmatrix}^T \tag{14}$$</p>
<p>To calculate $db_f, db_u, db_c, db_o$ you just need to sum across the horizontal (axis= 1) axis on $d\Gamma_f^{\langle t \rangle}, d\Gamma_u^{\langle t \rangle}, d\tilde c^{\langle t \rangle}, d\Gamma_o^{\langle t \rangle}$ respectively. Note that you should have the <code>keep_dims = True</code> option.</p>
<p>Finally, you will compute the derivative with respect to the previous hidden state, previous memory state, and input.</p>
<p>$$ da_{prev} = W_f^T*d\Gamma_f^{\langle t \rangle} + W_u^T * d\Gamma_u^{\langle t \rangle}+ W_c^T * d\tilde c^{\langle t \rangle} + W_o^T * d\Gamma_o^{\langle t \rangle} \tag{15}$$<br />
Here, the weights for equations 13 are the first n_a, (i.e. $W_f = W_f[:n_a,:]$ etc...)</p>
<p>$$ dc_{prev} = dc_{next}\Gamma_f^{\langle t \rangle} + \Gamma_o^{\langle t \rangle} * (1- \tanh(c_{next})^2)<em>\Gamma_f^{\langle t \rangle}</em>da_{next} \tag{16}$$<br />
$$ dx^{\langle t \rangle} = W_f^T*d\Gamma_f^{\langle t \rangle} + W_u^T * d\Gamma_u^{\langle t \rangle}+ W_c^T * d\tilde c_t + W_o^T * d\Gamma_o^{\langle t \rangle}\tag{17} $$<br />
where the weights for equation 15 are from n_a to the end, (i.e. $W_f = W_f[n_a:,:]$ etc...)</p>
<p><strong>Exercise:</strong> Implement <code>lstm_cell_backward</code> by implementing equations $7-17$ below. Good luck! :)</p>
<div class="hlcode"><pre><span class="k">def</span> <span class="nf">lstm_cell_backward</span><span class="p">(</span><span class="n">da_next</span><span class="p">,</span> <span class="n">dc_next</span><span class="p">,</span> <span class="n">cache</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implement the backward pass for the LSTM-cell (single time-step).</span>

<span class="sd">    Arguments:</span>
<span class="sd">    da_next -- Gradients of next hidden state, of shape (n_a, m)</span>
<span class="sd">    dc_next -- Gradients of next cell state, of shape (n_a, m)</span>
<span class="sd">    cache -- cache storing information from the forward pass</span>

<span class="sd">    Returns:</span>
<span class="sd">    gradients -- python dictionary containing:</span>
<span class="sd">                        dxt -- Gradient of input data at time-step t, of shape (n_x, m)</span>
<span class="sd">                        da_prev -- Gradient w.r.t. the previous hidden state, numpy array of shape (n_a, m)</span>
<span class="sd">                        dc_prev -- Gradient w.r.t. the previous memory state, of shape (n_a, m, T_x)</span>
<span class="sd">                        dWf -- Gradient w.r.t. the weight matrix of the forget gate, numpy array of shape (n_a, n_a + n_x)</span>
<span class="sd">                        dWi -- Gradient w.r.t. the weight matrix of the update gate, numpy array of shape (n_a, n_a + n_x)</span>
<span class="sd">                        dWc -- Gradient w.r.t. the weight matrix of the memory gate, numpy array of shape (n_a, n_a + n_x)</span>
<span class="sd">                        dWo -- Gradient w.r.t. the weight matrix of the output gate, numpy array of shape (n_a, n_a + n_x)</span>
<span class="sd">                        dbf -- Gradient w.r.t. biases of the forget gate, of shape (n_a, 1)</span>
<span class="sd">                        dbi -- Gradient w.r.t. biases of the update gate, of shape (n_a, 1)</span>
<span class="sd">                        dbc -- Gradient w.r.t. biases of the memory gate, of shape (n_a, 1)</span>
<span class="sd">                        dbo -- Gradient w.r.t. biases of the output gate, of shape (n_a, 1)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># Retrieve information from &quot;cache&quot;</span>
    <span class="p">(</span><span class="n">a_next</span><span class="p">,</span> <span class="n">c_next</span><span class="p">,</span> <span class="n">a_prev</span><span class="p">,</span> <span class="n">c_prev</span><span class="p">,</span> <span class="n">ft</span><span class="p">,</span> <span class="n">it</span><span class="p">,</span> <span class="n">cct</span><span class="p">,</span> <span class="n">ot</span><span class="p">,</span> <span class="n">xt</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span> <span class="o">=</span> <span class="n">cache</span>

    <span class="c">### START CODE HERE ###</span>
    <span class="c"># Retrieve dimensions from xt&#39;s and a_next&#39;s shape (≈2 lines)</span>
    <span class="n">n_x</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">n_a</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c"># Compute gates related derivatives, you can find their values can be found by looking carefully at equations (7) to (10) (≈4 lines)</span>
    <span class="n">dot</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">dcct</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">dit</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">dft</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c"># Code equations (7) to (10) (≈4 lines)</span>
    <span class="n">dit</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">dft</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">dot</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">dcct</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c"># Compute parameters related derivatives. Use equations (11)-(14) (≈8 lines)</span>
    <span class="n">dWf</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">dWi</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">dWc</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">dWo</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">dbf</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">dbi</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">dbc</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">dbo</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c"># Compute derivatives w.r.t previous hidden state, previous memory state and input. Use equations (15)-(17). (≈3 lines)</span>
    <span class="n">da_prev</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">dc_prev</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">dxt</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c">### END CODE HERE ###</span>

    <span class="c"># Save gradients in dictionary</span>
    <span class="n">gradients</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;dxt&quot;</span><span class="p">:</span> <span class="n">dxt</span><span class="p">,</span> <span class="s">&quot;da_prev&quot;</span><span class="p">:</span> <span class="n">da_prev</span><span class="p">,</span> <span class="s">&quot;dc_prev&quot;</span><span class="p">:</span> <span class="n">dc_prev</span><span class="p">,</span> <span class="s">&quot;dWf&quot;</span><span class="p">:</span> <span class="n">dWf</span><span class="p">,</span><span class="s">&quot;dbf&quot;</span><span class="p">:</span> <span class="n">dbf</span><span class="p">,</span> <span class="s">&quot;dWi&quot;</span><span class="p">:</span> <span class="n">dWi</span><span class="p">,</span><span class="s">&quot;dbi&quot;</span><span class="p">:</span> <span class="n">dbi</span><span class="p">,</span>
                <span class="s">&quot;dWc&quot;</span><span class="p">:</span> <span class="n">dWc</span><span class="p">,</span><span class="s">&quot;dbc&quot;</span><span class="p">:</span> <span class="n">dbc</span><span class="p">,</span> <span class="s">&quot;dWo&quot;</span><span class="p">:</span> <span class="n">dWo</span><span class="p">,</span><span class="s">&quot;dbo&quot;</span><span class="p">:</span> <span class="n">dbo</span><span class="p">}</span>

    <span class="k">return</span> <span class="n">gradients</span>
</pre></div>


<div class="hlcode"><pre><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">xt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">a_prev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">c_prev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">Wf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>
<span class="n">bf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Wi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>
<span class="n">bi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Wo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>
<span class="n">bo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Wc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>
<span class="n">bc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Wy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">by</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Wf&quot;</span><span class="p">:</span> <span class="n">Wf</span><span class="p">,</span> <span class="s">&quot;Wi&quot;</span><span class="p">:</span> <span class="n">Wi</span><span class="p">,</span> <span class="s">&quot;Wo&quot;</span><span class="p">:</span> <span class="n">Wo</span><span class="p">,</span> <span class="s">&quot;Wc&quot;</span><span class="p">:</span> <span class="n">Wc</span><span class="p">,</span> <span class="s">&quot;Wy&quot;</span><span class="p">:</span> <span class="n">Wy</span><span class="p">,</span> <span class="s">&quot;bf&quot;</span><span class="p">:</span> <span class="n">bf</span><span class="p">,</span> <span class="s">&quot;bi&quot;</span><span class="p">:</span> <span class="n">bi</span><span class="p">,</span> <span class="s">&quot;bo&quot;</span><span class="p">:</span> <span class="n">bo</span><span class="p">,</span> <span class="s">&quot;bc&quot;</span><span class="p">:</span> <span class="n">bc</span><span class="p">,</span> <span class="s">&quot;by&quot;</span><span class="p">:</span> <span class="n">by</span><span class="p">}</span>

<span class="n">a_next</span><span class="p">,</span> <span class="n">c_next</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="n">cache</span> <span class="o">=</span> <span class="n">lstm_cell_forward</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">a_prev</span><span class="p">,</span> <span class="n">c_prev</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>

<span class="n">da_next</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">dc_next</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">gradients</span> <span class="o">=</span> <span class="n">lstm_cell_backward</span><span class="p">(</span><span class="n">da_next</span><span class="p">,</span> <span class="n">dc_next</span><span class="p">,</span> <span class="n">cache</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dxt</span><span class="se">\&quot;</span><span class="s">][1][2] =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dxt&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dxt</span><span class="se">\&quot;</span><span class="s">].shape =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dxt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">da_prev</span><span class="se">\&quot;</span><span class="s">][2][3] =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;da_prev&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">da_prev</span><span class="se">\&quot;</span><span class="s">].shape =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;da_prev&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dc_prev</span><span class="se">\&quot;</span><span class="s">][2][3] =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dc_prev&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dc_prev</span><span class="se">\&quot;</span><span class="s">].shape =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dc_prev&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dWf</span><span class="se">\&quot;</span><span class="s">][3][1] =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dWf&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dWf</span><span class="se">\&quot;</span><span class="s">].shape =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dWf&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dWi</span><span class="se">\&quot;</span><span class="s">][1][2] =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dWi&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dWi</span><span class="se">\&quot;</span><span class="s">].shape =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dWi&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dWc</span><span class="se">\&quot;</span><span class="s">][3][1] =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dWc&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dWc</span><span class="se">\&quot;</span><span class="s">].shape =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dWc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dWo</span><span class="se">\&quot;</span><span class="s">][1][2] =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dWo&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dWo</span><span class="se">\&quot;</span><span class="s">].shape =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dWo&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dbf</span><span class="se">\&quot;</span><span class="s">][4] =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dbf&quot;</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dbf</span><span class="se">\&quot;</span><span class="s">].shape =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dbf&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dbi</span><span class="se">\&quot;</span><span class="s">][4] =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dbi&quot;</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dbi</span><span class="se">\&quot;</span><span class="s">].shape =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dbi&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dbc</span><span class="se">\&quot;</span><span class="s">][4] =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dbc&quot;</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dbc</span><span class="se">\&quot;</span><span class="s">].shape =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dbc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dbo</span><span class="se">\&quot;</span><span class="s">][4] =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dbo&quot;</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dbo</span><span class="se">\&quot;</span><span class="s">].shape =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dbo&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>


<p><strong>Expected Output</strong>:</p>
<table>
    <tr>
        <td>
            **gradients["dxt"][1][2]** =
        </td>
        <td>
           3.23055911511
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dxt"].shape** =
        </td>
        <td>
           (3, 10)
        </td>
    </tr>
        <tr>
        <td>
            **gradients["da_prev"][2][3]** =
        </td>
        <td>
           -0.0639621419711
        </td>
    </tr>
        <tr>
        <td>
            **gradients["da_prev"].shape** =
        </td>
        <td>
           (5, 10)
        </td>
    </tr>
         <tr>
        <td>
            **gradients["dc_prev"][2][3]** =
        </td>
        <td>
           0.797522038797
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dc_prev"].shape** =
        </td>
        <td>
           (5, 10)
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dWf"][3][1]** = 
        </td>
        <td>
           -0.147954838164
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dWf"].shape** =
        </td>
        <td>
           (5, 8)
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dWi"][1][2]** = 
        </td>
        <td>
           1.05749805523
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dWi"].shape** = 
        </td>
        <td>
           (5, 8)
        </td>
    </tr>
    <tr>
        <td>
            **gradients["dWc"][3][1]** = 
        </td>
        <td>
           2.30456216369
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dWc"].shape** = 
        </td>
        <td>
           (5, 8)
        </td>
    </tr>
    <tr>
        <td>
            **gradients["dWo"][1][2]** = 
        </td>
        <td>
           0.331311595289
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dWo"].shape** = 
        </td>
        <td>
           (5, 8)
        </td>
    </tr>
    <tr>
        <td>
            **gradients["dbf"][4]** = 
        </td>
        <td>
           [ 0.18864637]
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dbf"].shape** = 
        </td>
        <td>
           (5, 1)
        </td>
    </tr>
    <tr>
        <td>
            **gradients["dbi"][4]** = 
        </td>
        <td>
           [-0.40142491]
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dbi"].shape** = 
        </td>
        <td>
           (5, 1)
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dbc"][4]** = 
        </td>
        <td>
           [ 0.25587763]
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dbc"].shape** = 
        </td>
        <td>
           (5, 1)
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dbo"][4]** = 
        </td>
        <td>
           [ 0.13893342]
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dbo"].shape** = 
        </td>
        <td>
           (5, 1)
        </td>
    </tr>
</table>

<h3 id="33-backward-pass-through-the-lstm-rnn">3.3 Backward pass through the LSTM RNN</h3>
<p>This part is very similar to the <code>rnn_backward</code> function you implemented above. You will first create variables of the same dimension as your return variables. You will then iterate over all the time steps starting from the end and call the one step function you implemented for LSTM at each iteration. You will then update the parameters by summing them individually. Finally return a dictionary with the new gradients. </p>
<p><strong>Instructions</strong>: Implement the <code>lstm_backward</code> function. Create a for loop starting from $T_x$ and going backward. For each step call <code>lstm_cell_backward</code> and update the your old gradients by adding the new gradients to them. Note that <code>dxt</code> is not updated but is stored.</p>
<div class="hlcode"><pre><span class="k">def</span> <span class="nf">lstm_backward</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">caches</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implement the backward pass for the RNN with LSTM-cell (over a whole sequence).</span>

<span class="sd">    Arguments:</span>
<span class="sd">    da -- Gradients w.r.t the hidden states, numpy-array of shape (n_a, m, T_x)</span>
<span class="sd">    dc -- Gradients w.r.t the memory states, numpy-array of shape (n_a, m, T_x)</span>
<span class="sd">    caches -- cache storing information from the forward pass (lstm_forward)</span>

<span class="sd">    Returns:</span>
<span class="sd">    gradients -- python dictionary containing:</span>
<span class="sd">                        dx -- Gradient of inputs, of shape (n_x, m, T_x)</span>
<span class="sd">                        da0 -- Gradient w.r.t. the previous hidden state, numpy array of shape (n_a, m)</span>
<span class="sd">                        dWf -- Gradient w.r.t. the weight matrix of the forget gate, numpy array of shape (n_a, n_a + n_x)</span>
<span class="sd">                        dWi -- Gradient w.r.t. the weight matrix of the update gate, numpy array of shape (n_a, n_a + n_x)</span>
<span class="sd">                        dWc -- Gradient w.r.t. the weight matrix of the memory gate, numpy array of shape (n_a, n_a + n_x)</span>
<span class="sd">                        dWo -- Gradient w.r.t. the weight matrix of the save gate, numpy array of shape (n_a, n_a + n_x)</span>
<span class="sd">                        dbf -- Gradient w.r.t. biases of the forget gate, of shape (n_a, 1)</span>
<span class="sd">                        dbi -- Gradient w.r.t. biases of the update gate, of shape (n_a, 1)</span>
<span class="sd">                        dbc -- Gradient w.r.t. biases of the memory gate, of shape (n_a, 1)</span>
<span class="sd">                        dbo -- Gradient w.r.t. biases of the save gate, of shape (n_a, 1)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># Retrieve values from the first cache (t=1) of caches.</span>
    <span class="p">(</span><span class="n">caches</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="n">caches</span>
    <span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">cc1</span><span class="p">,</span> <span class="n">o1</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span> <span class="o">=</span> <span class="n">caches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c">### START CODE HERE ###</span>
    <span class="c"># Retrieve dimensions from da&#39;s and x1&#39;s shapes (≈2 lines)</span>
    <span class="n">n_a</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">T_x</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">n_x</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c"># initialize the gradients with the right sizes (≈12 lines)</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">da0</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">da_prevt</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">dc_prevt</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">dWf</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">dWi</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">dWc</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">dWo</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">dbf</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">dbi</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">dbc</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">dbo</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c"># loop back over the whole sequence</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">None</span><span class="p">)):</span>
        <span class="c"># Compute all gradients using lstm_cell_backward</span>
        <span class="n">gradients</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c"># Store or add the gradient to the parameters&#39; previous step&#39;s gradient</span>
        <span class="n">dx</span><span class="p">[:,:,</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">dWf</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">dWi</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">dWc</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">dWo</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">dbf</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">dbi</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">dbc</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">dbo</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c"># Set the first activation&#39;s gradient to the backpropagated gradient da_prev.</span>
    <span class="n">da0</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c">### END CODE HERE ###</span>

    <span class="c"># Store the gradients in a python dictionary</span>
    <span class="n">gradients</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;dx&quot;</span><span class="p">:</span> <span class="n">dx</span><span class="p">,</span> <span class="s">&quot;da0&quot;</span><span class="p">:</span> <span class="n">da0</span><span class="p">,</span> <span class="s">&quot;dWf&quot;</span><span class="p">:</span> <span class="n">dWf</span><span class="p">,</span><span class="s">&quot;dbf&quot;</span><span class="p">:</span> <span class="n">dbf</span><span class="p">,</span> <span class="s">&quot;dWi&quot;</span><span class="p">:</span> <span class="n">dWi</span><span class="p">,</span><span class="s">&quot;dbi&quot;</span><span class="p">:</span> <span class="n">dbi</span><span class="p">,</span>
                <span class="s">&quot;dWc&quot;</span><span class="p">:</span> <span class="n">dWc</span><span class="p">,</span><span class="s">&quot;dbc&quot;</span><span class="p">:</span> <span class="n">dbc</span><span class="p">,</span> <span class="s">&quot;dWo&quot;</span><span class="p">:</span> <span class="n">dWo</span><span class="p">,</span><span class="s">&quot;dbo&quot;</span><span class="p">:</span> <span class="n">dbo</span><span class="p">}</span>

    <span class="k">return</span> <span class="n">gradients</span>
</pre></div>


<div class="hlcode"><pre><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
<span class="n">a0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">Wf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>
<span class="n">bf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Wi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>
<span class="n">bi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Wo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>
<span class="n">bo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Wc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>
<span class="n">bc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Wf&quot;</span><span class="p">:</span> <span class="n">Wf</span><span class="p">,</span> <span class="s">&quot;Wi&quot;</span><span class="p">:</span> <span class="n">Wi</span><span class="p">,</span> <span class="s">&quot;Wo&quot;</span><span class="p">:</span> <span class="n">Wo</span><span class="p">,</span> <span class="s">&quot;Wc&quot;</span><span class="p">:</span> <span class="n">Wc</span><span class="p">,</span> <span class="s">&quot;Wy&quot;</span><span class="p">:</span> <span class="n">Wy</span><span class="p">,</span> <span class="s">&quot;bf&quot;</span><span class="p">:</span> <span class="n">bf</span><span class="p">,</span> <span class="s">&quot;bi&quot;</span><span class="p">:</span> <span class="n">bi</span><span class="p">,</span> <span class="s">&quot;bo&quot;</span><span class="p">:</span> <span class="n">bo</span><span class="p">,</span> <span class="s">&quot;bc&quot;</span><span class="p">:</span> <span class="n">bc</span><span class="p">,</span> <span class="s">&quot;by&quot;</span><span class="p">:</span> <span class="n">by</span><span class="p">}</span>

<span class="n">a</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">caches</span> <span class="o">=</span> <span class="n">lstm_forward</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>

<span class="n">da</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">gradients</span> <span class="o">=</span> <span class="n">lstm_backward</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">caches</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dx</span><span class="se">\&quot;</span><span class="s">][1][2] =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dx&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dx</span><span class="se">\&quot;</span><span class="s">].shape =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dx&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">da0</span><span class="se">\&quot;</span><span class="s">][2][3] =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;da0&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">da0</span><span class="se">\&quot;</span><span class="s">].shape =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;da0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dWf</span><span class="se">\&quot;</span><span class="s">][3][1] =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dWf&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dWf</span><span class="se">\&quot;</span><span class="s">].shape =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dWf&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dWi</span><span class="se">\&quot;</span><span class="s">][1][2] =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dWi&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dWi</span><span class="se">\&quot;</span><span class="s">].shape =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dWi&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dWc</span><span class="se">\&quot;</span><span class="s">][3][1] =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dWc&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dWc</span><span class="se">\&quot;</span><span class="s">].shape =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dWc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dWo</span><span class="se">\&quot;</span><span class="s">][1][2] =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dWo&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dWo</span><span class="se">\&quot;</span><span class="s">].shape =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dWo&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dbf</span><span class="se">\&quot;</span><span class="s">][4] =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dbf&quot;</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dbf</span><span class="se">\&quot;</span><span class="s">].shape =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dbf&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dbi</span><span class="se">\&quot;</span><span class="s">][4] =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dbi&quot;</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dbi</span><span class="se">\&quot;</span><span class="s">].shape =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dbi&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dbc</span><span class="se">\&quot;</span><span class="s">][4] =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dbc&quot;</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dbc</span><span class="se">\&quot;</span><span class="s">].shape =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dbc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dbo</span><span class="se">\&quot;</span><span class="s">][4] =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dbo&quot;</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients[</span><span class="se">\&quot;</span><span class="s">dbo</span><span class="se">\&quot;</span><span class="s">].shape =&quot;</span><span class="p">,</span> <span class="n">gradients</span><span class="p">[</span><span class="s">&quot;dbo&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>


<p><strong>Expected Output</strong>:</p>
<table>
    <tr>
        <td>
            **gradients["dx"][1][2]** =
        </td>
        <td>
           [-0.00173313  0.08287442 -0.30545663 -0.43281115]
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dx"].shape** =
        </td>
        <td>
           (3, 10, 4)
        </td>
    </tr>
        <tr>
        <td>
            **gradients["da0"][2][3]** =
        </td>
        <td>
           -0.095911501954
        </td>
    </tr>
        <tr>
        <td>
            **gradients["da0"].shape** =
        </td>
        <td>
           (5, 10)
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dWf"][3][1]** = 
        </td>
        <td>
           -0.0698198561274
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dWf"].shape** =
        </td>
        <td>
           (5, 8)
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dWi"][1][2]** = 
        </td>
        <td>
           0.102371820249
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dWi"].shape** = 
        </td>
        <td>
           (5, 8)
        </td>
    </tr>
    <tr>
        <td>
            **gradients["dWc"][3][1]** = 
        </td>
        <td>
           -0.0624983794927
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dWc"].shape** = 
        </td>
        <td>
           (5, 8)
        </td>
    </tr>
    <tr>
        <td>
            **gradients["dWo"][1][2]** = 
        </td>
        <td>
           0.0484389131444
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dWo"].shape** = 
        </td>
        <td>
           (5, 8)
        </td>
    </tr>
    <tr>
        <td>
            **gradients["dbf"][4]** = 
        </td>
        <td>
           [-0.0565788]
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dbf"].shape** = 
        </td>
        <td>
           (5, 1)
        </td>
    </tr>
    <tr>
        <td>
            **gradients["dbi"][4]** = 
        </td>
        <td>
           [-0.06997391]
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dbi"].shape** = 
        </td>
        <td>
           (5, 1)
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dbc"][4]** = 
        </td>
        <td>
           [-0.27441821]
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dbc"].shape** = 
        </td>
        <td>
           (5, 1)
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dbo"][4]** = 
        </td>
        <td>
           [ 0.16532821]
        </td>
    </tr>
        <tr>
        <td>
            **gradients["dbo"].shape** = 
        </td>
        <td>
           (5, 1)
        </td>
    </tr>
</table>

<h3 id="congratulations">Congratulations !</h3>
<p>Congratulations on completing this assignment. You now understand how recurrent neural networks work! </p>
<p>Lets go on to the next exercise, where you'll use an RNN to build a character-level language model.</p>
<div class="hlcode"><pre>
</pre></div>
</div>
<div id="content-footer">
  <p>如果你觉得这篇文章对你有帮助，不妨请我喝杯咖啡，鼓励我创造更多</p>
<table>
  <tr><td><img src="/static/images/My/WeChatPay.jpeg" style="width:200px;height:200px;"></td>
  <td><img src="/static/images/My/AliPay.jpeg" style="width:200px;height:200px;"></td></tr>
</table>created in <span class="create-date date"> 2018-02-23 13:01 </span></div>
<div id="comments"></div>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script type="text/javascript">
const gitment = new Gitment({
  id: 'rnn-basics',
  title: 'rnn-basics',
  owner: 'kitianFresh',
  repo: 'MetaHacksWiki',
  oauth: {
    client_id: '759b6fcf793dbef4e7a0',
    client_secret: '3c8fcf8b0a76c4acfc07b01a97e4f55f4c6ecbbd',
  },
  // ...
  // For more available options, check out the documentation below
})

gitment.render('comments')
// or
// gitment.render(document.getElementById('comments'))
// or
// document.body.appendChild(gitment.render())
</script>

        </div>
        <div id="footer">
            <span>
                Copyright © 2019 田奇.
                Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
                Fork me in <a href="https://github.com/kitianFresh/MetaHacksWiki/tree/master" target="_blank"> github </a>.
            </span>
        </div>
        

        <script src="/tipuesearch_content.js"></script>
        <script src="/static/plugin/tipuesearch/tipuesearch_set.js"></script>
        <script src="/static/plugin/tipuesearch/tipuesearch.min.js"></script>
    </body>
</html>