<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>flask - MetaHacks Wiki</title>
    <meta name="keywords" content="wiki, simiki, computer, cognitive,"/>
    <meta name="description" content="my personal wiki"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>

  <body>
    <div id="container">
      
<div id="header">
  <div class="post-nav"><a href="/">Home</a>&nbsp;&#187;&nbsp;<a href="/#pythonweb">pythonweb</a>&nbsp;&#187;&nbsp;flask
    <span class="updated">Updated&nbsp;
      2017-04-23 21:23
    </span></div>
</div>
<div class="clearfix"></div>

<div class="page_title">flask</div>

  <h1 id="flaskr">flaskr 开发笔记</h1>
<h2 id="python">Python 虚拟环境使用</h2>
<p>虚拟环境很好使，推荐使用，他不会影响你的Ubuntu自带的Python环境，相当于重新创建了一个Python环境，然后在这个环境下进行包的安装和开发！以下是简单的安装和使用方法</p>
<div class="hlcode"><pre><span></span>// 可能没得virtaualenv，先安装
sudo apt-get install python-pip python-dev python-virtualenv
// 然后新建一个目录,比如你的项目
mkdir todo-api
cd todo-api
// 该句会创建一个flask目录，就是一个新的Python虚拟环境，里面的目录结构其实和主机上Python目录结构很类似，都有bin目录下的命令，比如pip，python，activate等
virtualenv flask
//然后你可以使用flask/bin/pip安装项目需要的依赖包，此时安装的就是Flask包了，他在flask/lib/python2.7/site-packages目录下面，不会影响local Python的。
flask/bin/pip install flask
//如果你想要运行.py文件，可以直接使用
flask/bin/python app.py
//当然还可以使用
chmod a+x app.py
./app.py
</pre></div>


<h2 id="web-app">web app 配置方式</h2>
<blockquote>
<p>Flask allows you to import multiple configurations and it will use the setting defined in the last import. <br />
从文件导入配置</p>
</blockquote>
<div class="hlcode"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_pyfile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>


<p>从对象导入配置</p>
<div class="hlcode"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="n">obj</span><span class="p">:</span> <span class="n">string</span><span class="p">,</span> <span class="err">叫这个名字的模块会被</span><span class="n">import</span><span class="p">,</span><span class="err">也可以是一个直接已经导入的</span><span class="nb">object</span>
</pre></div>


<p>从环境变量指定的地方导入</p>
<div class="hlcode"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_envvar</span><span class="p">(</span><span class="n">variable_name</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>


<p>从一个词典导入，运行时更新</p>
<div class="hlcode"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
</pre></div>


<h2 id="flask">flask 引入上下文的概念</h2>
<p>为了保证同一个请求共享数据库连接，而不是反复connect_db(),flask引入applocation context的概念，g 是全局共享的</p>
<div class="hlcode"><pre><span></span><span class="k">def</span> <span class="nf">get_db</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Opens a new database connection if there is none yet for the</span>
<span class="sd">    current application context.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;sqlite_db&#39;</span><span class="p">):</span>
        <span class="n">g</span><span class="o">.</span><span class="n">sqlite_db</span> <span class="o">=</span> <span class="n">connect_db</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">sqlite_db</span>
</pre></div>


<h2 id="flask-app">flask 提供命令行接口，并可以读取APP资源</h2>
<div class="hlcode"><pre><span></span>def init_db():
    db = get_db()
    with app.open_resource(&#39;schema.sql&#39;, mode=&#39;r&#39;) as f:
        db.cursor().executescript(f.read())
    db.commit()
# flask的命令行接口创建数据库
@app.cli.command(&#39;initdb&#39;)
def initdb_command():
    init_db()
    print &#39;Initialized the database.&#39;
</pre></div>
    </div>
    <div id="footer">
      <span>
        <p>Copyright © 2017 田奇.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.</p>
        <p>Site Generated 2017-11-03 22:00:29</p>
      </span>
    </div>
  </body>
</html>